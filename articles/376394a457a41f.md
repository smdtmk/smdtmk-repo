---
title: "Amazon Linux2023ã§Sambaãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã—ã¦ã¿ãŸ"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [aws,samba]
published: true
---

## ã¯ã˜ã‚ã«
æ¥­å‹™ã§AmazonLinux2023ã‚’ä½¿ã£ãŸSambaãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹è¦ä»¶ãŒå‡ºã¦ããŸã®ã§ã™ãŒ
ç§è‡ªèº«ã€Sambaã‚’è§¦ã£ãŸã“ã¨ãŒãªã„ã®ã§å¾Œå­¦ã®ãŸã‚ã«èª¿ã¹ãªãŒã‚‰æ§‹ç¯‰ã—ã¦ã¿ã‚ˆã†æ€ã„ã¾ã™ã€‚

## å…ˆã«çµè«–
Amazon Linux2023ã§ã‚‚Amazon Linux2ã¨åŒæ§˜ã®æ‰‹é †ã§å•é¡ŒãªãSambaã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ç’°å¢ƒ
- Mac
- Vscode
- Windows

## äº‹å‰æº–å‚™
ä¸‹è¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦EC2ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãŠãã¾ã™ã€‚
```yml:lib/vpc-stack.ts
AWSTemplateFormatVersion: "2010-09-09"

Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsSupport: true
      EnableDnsHostnames: true
      InstanceTenancy: default
      Tags:
      - Key: Name
        Value: VPC-Samba-Server

  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
      - Key: Name
        Value: IGW-Samba-Server

  IGWAttachment:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway

  PublicSubnet:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.0.0/24
      AvailabilityZone: !Select [ 0, !GetAZs ]
      MapPublicIpOnLaunch: true
      Tags:
      - Key: Name
        Value: PublicSubnet-Samba-Server

  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
      Tags:
      - Key: Name
        Value: PublicRouteTable-Samba-Server

  PublicRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  PublicSubnetRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet
      RouteTableId: !Ref PublicRouteTable

  SambaSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: SambaSecurityGroup-Samba-Server
      GroupDescription: Allow Samba traffic
      VpcId: !Ref VPC
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: 445
        ToPort: 445
        CidrIp: 0.0.0.0/0
      Tags:
      - Key: Name
        Value: SambaSecurityGroup-Samba-Server

  SambaInstanceRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
        - Effect: Allow
          Principal:
            Service:
            - ec2.amazonaws.com
          Action:
          - sts:AssumeRole
      Path: /
      ManagedPolicyArns:
      - arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore

  SambaInstanceProfile:
    DependsOn: SambaInstanceRole
    Type: AWS::IAM::InstanceProfile
    Properties:
      Path: /
      Roles:
      - !Ref SambaInstanceRole

  SambaInstance:
    DependsOn: SambaInstanceProfile
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-0f9fe1d9214628296
      InstanceType: t2.micro
      BlockDeviceMappings:
      - DeviceName: /dev/sdf
        Ebs:
          VolumeSize: 10
          VolumeType: gp3
      IamInstanceProfile: !Ref SambaInstanceProfile
      UserData: !Base64 |
        #!/bin/bash
        sudo dnf update -y
        sudo yum install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm
        sudo systemctl start amazon-ssm-agent
      SecurityGroupIds:
      - !Ref SambaSecurityGroup
      SubnetId: !Ref PublicSubnet
      Tags:
      - Key: Name
        Value: Samba-Server

  SambaServerEIP:
    Type: AWS::EC2::EIP
    Properties:
      Domain: vpc
      InstanceId: !Ref SambaInstance
```

## 1. Sambaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
sudo yum -y install samba
```

## 2. Sambaãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
 Sambaãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚ã«PWã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ãŒSambaã«æ¥ç¶šã™ã‚‹éš›ã«å¿…è¦ã«ãªã‚Šã¾ã™ã®ã§æ§ãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚
```bash
#OSãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
sudo useradd samba-user

#Sambaã«OSãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™»éŒ²
sudo pdbedit -a sambda-user

#ç™»éŒ²çŠ¶æ³ã‚’ç¢ºèª
sudo pdbedit -L
samba-user:1002:
```

## 3. Sambaèµ·å‹•
```bash
sudo systemctl start smb.service
sudo systemctl enable smb.service
```

## 4. Windowsã‹ã‚‰æ¥ç¶šã§ãã‚‹ã‹ç¢ºèª
1. Windowsã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã„ã¦"Â¥Â¥<EC2ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IP>"ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
2. èªè¨¼æƒ…å ±ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§å…ˆã»ã©ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨PWã‚’å…¥åŠ›ã—ã¾ã™ã€‚
3. ä¸‹è¨˜ç”»é¢ã®ã‚ˆã†ã«Sambaã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸã€‚
![](/images/samba_win01.png)

## å‚è€ƒ
https://dev.classmethod.jp/articles/amazonlinux2-samba/

## ãŠã‚ã‚Šã«
ä»Šå›æ§‹ç¯‰ã—ãŸã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ã„ã˜ã‚ŠãªãŒã‚‰ã‚‚ã†å°‘ã—å‹‰å¼·ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
